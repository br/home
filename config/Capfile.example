#!/usr/bin/env ruby

require 'alpha_omega/deploy'

# application deploy
namespace :application do
  task :update_code do
    update_config
  end

  task :update_config do
    run "touch #{deploy_release}/config/example.yml"
  end

  task :restart do
    run "sudo service example reload"
  end
end

after "deploy:update_code","application:update_code"
after "deploy:restart","application:restart"

# interesting hosts
Deploy self, File.join(File.expand_path('../gems', __FILE__), "config", "deploy.yml") do |admin, node| 
  if node["run_list"].member?("role[application]")
    { :deploy => { }
    }
  end
end
